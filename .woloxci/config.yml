config:
  dockerfile: .woloxci/Dockerfile
  project_name: rails-bootstrap

services:
  - postgres
  - redis

steps:
  analysis:
    - bundle exec rubocop -R app spec --format simple
    - bundle exec rubycritic --path ./analysis --minimum-score 80 --no-browser
  setup_db:
    - PARALLEL_TEST_PROCESSORS=4 bundle exec rake parallel:create
    - PARALLEL_TEST_PROCESSORS=4 bundle exec rake parallel:load_schema
  test:
    - PARALLEL_TEST_PROCESSORS=4 bundle exec rake parallel:spec
  security:
    - bundle exec brakeman --exit-on-error

environment:
  RAILS_ENV: test
  GIT_COMMITTER_NAME: a
  GIT_COMMITTER_EMAIL: b
  LANG: C.UTF-8
